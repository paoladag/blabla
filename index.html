<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Malla Curricular Derecho UCV</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    margin: 0;
    min-height: 100vh;
    font-family: Arial, sans-serif;
    background: #114087;
    color: #222;
    overflow-x: auto;
  }
  h1 {
    color: white;
    text-align: center;
    margin: 30px 0 20px;
    user-select: none;
  }
  .main-container {
    max-width: 1280px;
    margin: auto;
    display: flex;
    flex-direction: row;
    gap: 30px;
    padding: 0 10px;
    align-items: stretch; /* crucial para igualar altura columnas */
    flex-wrap: wrap;
  }
  .vertical-column {
    display: flex;
    flex-direction: column;
    gap: 30px;
    min-width: 250px;
    flex: 1 1 250px;
    max-width: 300px;
    box-sizing: border-box;
    align-items: stretch;
  }
  .column-block {
    background: #FFBD59;
    border-radius: 16px;
    padding: 20px 15px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    align-items: stretch;
    flex-shrink: 0;
  }
  /* Bloques inferiores para estirarse y compensar altura */
  #cuarto-ano-block,
  #quinto-ano-block,
  #especiales-block {
    flex-grow: 1;
    min-height: 100px;
  }
  .col-title {
    font-weight: bold;
    font-size: 1.2em;
    color: #114087;
    text-align: center;
    text-transform: uppercase;
    margin-bottom: 15px;
    user-select: none;
  }
  button.asignatura, button.especial-btn {
    font-size: 1em;
    padding: 12px 14px;
    border: none;
    border-radius: 12px;
    background: white;
    margin-bottom: 12px;
    color: #114087;
    font-weight: 500;
    text-align: left;
    cursor: pointer;
    box-shadow: 0 1.5px 6px rgba(18, 39, 124, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    user-select: none;
  }
  button.asignatura[aria-disabled="true"], button.especial-btn[aria-disabled="true"] {
    cursor: not-allowed;
    background: #d1d1d151;
    color: #5871a0;
    opacity: 0.7;
  }
  button.asignatura.aprobada, button.especial-btn.aprobada {
    background: #114087;
    color: white;
    text-decoration: line-through;
    font-weight: 700;
  }
  .uc-label, .especial-uc-label {
    font-size: 0.9em;
    color: #114087b8;
    flex-shrink: 0;
    padding-left: 6px;
    user-select: none;
  }
  .tooltip {
    visibility: hidden;
    background: rgba(34,44,68,0.9);
    color: white;
    padding: 7px 10px;
    border-radius: 8px;
    font-size: 0.9em;
    position: absolute;
    bottom: 130%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    max-width: 260px;
    user-select: none;
    z-index: 10;
  }
  button.asignatura[aria-disabled="true"]:hover .tooltip,
  button.especial-btn[aria-disabled="true"]:hover .tooltip {
    visibility: visible;
    opacity: 1;
    pointer-events: auto;
  }
  .info-col {
    background: white;
    border-radius: 12px;
    font-weight: 500;
    color: #114087;
    padding: 14px 12px;
    box-shadow: 0 1.5px 6px rgba(18, 39, 124, 0.1);
    user-select: none;
    line-height: 1.4;
  }
  .info-col p {
    margin: 0 0 8px 0;
  }
  .info-col p:last-child {
    margin-bottom: 0;
  }
  @media (max-width: 900px) {
    .main-container {
      flex-direction: column;
      align-items: center;
    }
    .vertical-column {
      width: 100% !important;
      max-width: none !important;
    }
  }
  .footer {
    color: white;
    text-align: center;
    font-size: 1em;
    margin-bottom: 25px;
    user-select: none;
  }
</style>
</head>
<body>
<h1 title="Shift + doble clic limpia progreso">Malla Curricular - Derecho<br>Universidad Central de Venezuela</h1>

<div class="main-container" id="main-container">
  <div class="vertical-column" id="col-1">
    <div class="column-block" id="primer-ano-block"></div>
    <div class="column-block" id="cuarto-ano-block"></div>
  </div>
  <div class="vertical-column" id="col-2">
    <div class="column-block" id="segundo-ano-block"></div>
    <div class="column-block" id="quinto-ano-block"></div>
  </div>
  <div class="vertical-column" id="col-3">
    <div class="column-block" id="tercer-ano-block"></div>
    <div class="column-block" id="especiales-block"></div>
  </div>
</div>

<div class="footer">Recuerda que: Unidos Somos Más</div>

<script>
  const MALLA = [
    { year: "Primer año", materias: [
      { id: "1101", nombre: "Derecho Civil I", uc: 6},
      { id: "1201", nombre: "Derecho Constitucional", uc: 6},
      { id: "1501", nombre: "Introducción al Derecho", uc: 6},
      { id: "1502", nombre: "Derecho Romano I", uc: 6},
      { id: "1601", nombre: "Economía Política", uc: 6},
      { id: "1602", nombre: "Sociología Jurídica", uc: 6},
    ]},
    { year: "Segundo año", materias: [
      { id: "1102", nombre: "Derecho Civil II", uc: 6, deps: ["1101", "1501"] },
      { id: "1202", nombre: "Derecho Administrativo I", uc: 6, deps: ["1201"] },
      { id: "1206", nombre: "Derecho Internacional Público", uc: 6, deps: ["1201"] },
      { id: "1301", nombre: "Derecho Penal I", uc: 6 },
      { id: "1303", nombre: "Criminología", uc: 6 },
      { id: "1503", nombre: "Derecho Romano II", uc: 6, deps: ["1502"] }
    ]},
    { year: "Tercer año", materias: [
      { id: "1103", nombre: "Derecho Civil III", uc: 6, deps: ["1101", "1501"] },
      { id: "1203", nombre: "Derecho Administrativo II", uc: 6, deps: ["1202"] },
      { id: "1205", nombre: "Finanzas Públicas", uc: 6, deps: ["1202", "1601"] },
      { id: "1302", nombre: "Derecho Penal II", uc: 6, deps: ["1301"] },
      { id: "1504", nombre: "Filosofía del Derecho", uc: 6 },
      { id: "1902", nombre: "Práctica Jurídica I", uc: 6, deps: ["1101", "1501"]}
    ]},
    { year: "Cuarto año", materias: [
      { id: "1104", nombre: "Derecho Civil IV", uc: 6, deps: ["1102"] },
      { id: "1106", nombre: "Contratos y Garantías", uc: 6, deps: ["1103"] },
      { id: "1107", nombre: "Derecho Mercantil I", uc: 6, deps: ["1103"] },
      { id: "1109", nombre: "Derecho del trabajo", uc: 6, deps: ["1103"] },
      { id: "1401", nombre: "Derecho Procesal Civil I", uc: 6, deps: ["1102"] },
      { id: "1903", nombre: "Práctica Jurídica II", uc: 6, deps: ["1902"] },
    ]},
    { year: "Quinto año", materias: [
      { id: "1108", nombre: "Derecho Mercantil II", uc: 6, deps: ["1107"] },
      { id: "1110", nombre: "Derecho Internacional Privado", uc: 6, deps: ["1103", "1401"] },
      { id: "1207", nombre: "Derecho Administrativo III", uc: 6, deps: ["1203", "1401"] },
      { id: "1402", nombre: "Derecho Procesal Civil II", uc: 6, deps: ["1401"] },
      { id: "1403", nombre: "Derecho Procesal Penal", uc: 6, deps: ["1302", "1401"] },
      { id: "1904", nombre: "Práctica Jurídica III", uc: 6, deps: ["1401", "1903"] }
    ]}
  ];
  const ESPECIALES = [
    { id: "1905", nombre: "Seminario / Curso de Extensión", uc: 2, necesitaCreditos: 72 },
    { id: "SC", nombre: "Servicio Comunitario", uc: 0, necesitaCreditos: 91 }
  ];
  const STORAGE_KEY = "der_ucv_aprobadas_v2";

  function obtenerAprobadas() {
    try {
      return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    } catch {
      return [];
    }
  }
  function guardarAprobadas(aprobadas) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(aprobadas));
  }
  function getMateriaPorId(id) {
    for (const bloque of MALLA) {
      const encontrada = bloque.materias.find(mat => mat.id === id);
      if (encontrada) return encontrada;
    }
    if (id === "SC") return ESPECIALES.find(esp => esp.id === id) || null;
    return null;
  }
  function requisitosNoAprobados(materia, aprobadas) {
    if (!materia.deps) return [];
    return (materia.deps || []).filter(reqId => !aprobadas.includes(reqId));
  }
  function calcCreditosAprobados(aprobadas) {
    let total = 0;
    for (const bloque of MALLA) {
      for (const mat of bloque.materias) {
        if (aprobadas.includes(mat.id) && mat.uc) total += mat.uc;
      }
    }
    for (const esp of ESPECIALES) {
      if (aprobadas.includes(esp.id) && esp.uc) total += esp.uc;
    }
    return total;
  }
  function crearBotonMateria(materia) {
    const aprobadas = obtenerAprobadas();
    const reqsNoAprob = requisitosNoAprobados(materia, aprobadas);
    const bloqueada = reqsNoAprob.length > 0;
    const btn = document.createElement("button");
    btn.className = "asignatura";
    btn.setAttribute("data-id", materia.id);
    btn.tabIndex = 0;
    btn.innerHTML = `<span>${materia.nombre}</span><span class="uc-label">${materia.uc} UC</span>`;
    if (aprobadas.includes(materia.id)) {
      btn.classList.add("aprobada");
      btn.setAttribute("aria-pressed", "true");
    } else {
      btn.setAttribute("aria-pressed", "false");
    }
    if (bloqueada) {
      btn.setAttribute("aria-disabled", "true");
      btn.tabIndex = -1;
      const tooltip = document.createElement("span");
      tooltip.className = "tooltip";
      tooltip.textContent = `Debes aprobar primero: ${reqsNoAprob.map(id => {
        const m = getMateriaPorId(id);
        return m ? m.nombre : id;
      }).join(", ")}`;
      btn.appendChild(tooltip);
    } else {
      btn.removeAttribute("aria-disabled");
      btn.addEventListener("click", () => toggleAprobada(materia.id));
    }
    return btn;
  }
  function crearBotonEspecial(especial) {
    const aprobadas = obtenerAprobadas();
    const totalCredAprob = calcCreditosAprobados(aprobadas);
    const bloqueada = totalCredAprob < especial.necesitaCreditos;
    const btn = document.createElement("button");
    btn.className = "especial-btn";
    btn.setAttribute("data-id", especial.id);
    const nombreSpan = document.createElement("span");
    nombreSpan.textContent = especial.nombre;
    btn.appendChild(nombreSpan);
    if (especial.uc && especial.uc > 0) {
      const ucSpan = document.createElement("span");
      ucSpan.className = "especial-uc-label";
      ucSpan.textContent = `${especial.uc} UC`;
      btn.appendChild(ucSpan);
    }
    if (aprobadas.includes(especial.id)) {
      btn.classList.add("aprobada");
      btn.setAttribute("aria-pressed", "true");
    } else {
      btn.setAttribute("aria-pressed", "false");
    }
    if (bloqueada) {
      btn.setAttribute("aria-disabled", "true");
      btn.tabIndex = -1;
      const tooltip = document.createElement("span");
      tooltip.className = "tooltip";
      tooltip.textContent = `Debes tener aprobados ${especial.necesitaCreditos} créditos.`;
      btn.appendChild(tooltip);
    } else {
      btn.removeAttribute("aria-disabled");
      btn.addEventListener("click", () => toggleAprobada(especial.id));
    }
    return btn;
  }
  function renderMalla() {
    document.getElementById('primer-ano-block').innerHTML = '';
    document.getElementById('segundo-ano-block').innerHTML = '';
    document.getElementById('tercer-ano-block').innerHTML = '';
    document.getElementById('cuarto-ano-block').innerHTML = '';
    document.getElementById('quinto-ano-block').innerHTML = '';
    document.getElementById('especiales-block').innerHTML = '';
    MALLA.forEach(bloque => {
      let containerId = '';
      switch (bloque.year) {
        case "Primer año": containerId = 'primer-ano-block'; break;
        case "Segundo año": containerId = 'segundo-ano-block'; break;
        case "Tercer año": containerId = 'tercer-ano-block'; break;
        case "Cuarto año": containerId = 'cuarto-ano-block'; break;
        case "Quinto año": containerId = 'quinto-ano-block'; break;
      }
      if(containerId) {
        const cont = document.getElementById(containerId);
        cont.insertAdjacentHTML('beforeend', `<div class="col-title">${bloque.year}</div>`);
        bloque.materias.forEach(materia => {
          cont.appendChild(crearBotonMateria(materia));
        });
      }
    });
    const especialesBlock = document.getElementById('especiales-block');
    ESPECIALES.forEach(especial => {
      especialesBlock.appendChild(crearBotonEspecial(especial));
    });
    const infoDiv = document.createElement("div");
    infoDiv.className = "info-col";
    infoDiv.innerHTML =
      `<p>Para cursar <b>Seminario o Curso de Extensión</b>, deben haberse aprobado 72 créditos.</p>` +
      `<p>Para realizar <b>Servicio Comunitario</b>, deben haberse aprobado 91 créditos.</p>`;
    especialesBlock.appendChild(infoDiv);
  }
  function toggleAprobada(matId) {
    let aprobadas = obtenerAprobadas();
    if (aprobadas.includes(matId)) {
      aprobadas = aprobadas.filter(id => id !== matId);
    } else {
      aprobadas.push(matId);
    }
    guardarAprobadas(aprobadas);
    renderMalla();
  }
  window.addEventListener("DOMContentLoaded", renderMalla);
  document.querySelector("h1").ondblclick = function(e){
    if(e.shiftKey){
      if(confirm("¿Seguro que deseas borrar todo el progreso guardado?")){
        localStorage.removeItem(STORAGE_KEY);
        renderMalla();
      }
    }
  }
</script>
</body>
</html>
